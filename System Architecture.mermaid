graph TB
    subgraph "Client Layer"
        UI[Web/Mobile UI]
        CodeEditor[Code Editor]
        DiagramEditor[Diagram Editor<br/>Mermaid]
    end
    
    subgraph "API Gateway & Auth"
        Gateway[API Gateway]
        RateLimit[Rate Limiter]
        Auth[Auth Service<br/>JWT]
    end
    
    subgraph "Content Management"
        ScenarioDB[(Scenario DB)]
        ConstraintsDB[(Constraints DB)]
        TestCaseDB[(Test Cases)]
        TemplateDB[(Solution Templates)]
    end
    
    subgraph "Core Practice Services"
        Router[Practice Router<br/>(Thin Dispatcher + Step Gate)]
        
        subgraph "Code Practice"
            CodeHandler[Code Submission]
            Sandbox[Sandbox Runner]
            CodeCheck[Code Check<br/>(Run Tests)]
        end
        
        subgraph "Debug Practice"
            DebugHandler[Debug Submission]
            DebugCheck[Debug Check<br/>(Diff/Explain)]
        end
        
        subgraph "System Practice"
            SystemHandler[System Design Submission]
            SystemCheck[System Check<br/>(Checklist)]
        end
        
        subgraph "Ops Practice"
            OpsHandler[Incident Submission]
            OpsCheck[Ops Check<br/>(Checklist)]
        end
        
        subgraph "Agent Practice"
            AgentHandler[Agent Submission]
            AgentCheck[Agent Check<br/>(Checklist)]
        end
    end
    
    subgraph "Evaluation Engine (Unified)"
        TestManager[Test Case / Rule Manager]
        ObjectiveFB[Objective Feedback<br/>(pass/fail, score, reasons)]
    end

    subgraph AI_LLM_Layer["AI/LLM Layer (MVP: 1 Box Only)"]
        LLMFeedback["Feedback Generator (LLM)\n- Hint/Coach\n- Best Practice Summary\n- Next Step Tip"]
    end
    
    subgraph "User Progress"
        ProgressTracker[Progress Tracker<br/>(current_step 1~5)]
        UserHistory[(User Data & History)]
        Recommender[Next Step (Rule-based)]
    end
    
    subgraph "Infrastructure (MVP)"
        Storage[Object Storage<br/>(optional)]
        Cache[Cache<br/>(optional)]
        Monitoring[Monitoring & Logging<br/>(minimal)]
    end
    
    UI --> Gateway
    CodeEditor --> Gateway
    DiagramEditor --> Gateway
    
    Gateway --> RateLimit --> Auth --> Router
    
    %% 사용자 선택에 따른 분배(아이콘 클릭=practice 지정)
    Router --> CodeHandler
    Router --> DebugHandler
    Router --> SystemHandler
    Router --> OpsHandler
    Router --> AgentHandler
    
    %% Practice별 최소 체크만 수행
    CodeHandler --> Sandbox --> CodeCheck
    DebugHandler --> DebugCheck
    SystemHandler --> SystemCheck
    OpsHandler --> OpsCheck
    AgentHandler --> AgentCheck
    
    %% 컨텐츠 연결(최소)
    ScenarioDB --> Router
    ConstraintsDB --> Router
    TestCaseDB --> TestManager
    TemplateDB --> TestManager
    
    %% 공통 평가 엔진으로 수렴
    CodeCheck --> TestManager
    DebugCheck --> TestManager
    SystemCheck --> TestManager
    OpsCheck --> TestManager
    AgentCheck --> TestManager
    
    TestManager --> ObjectiveFB
    ObjectiveFB --> LLMFeedback
    
    %% 진행도/추천(룰 기반)
    LLMFeedback --> ProgressTracker
    ProgressTracker --> UserHistory
    UserHistory --> Recommender
    Recommender --> UI
    
    %% 인프라(옵션)
    Monitoring -.-> Router
    Storage -.-> Router
    Cache -.-> Router
